<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Mart - Seamless E-Commerce Platform</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet.js - Free OpenStreetMap integration (No API key required) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-shopping-cart"></i>
                <span>Live Mart</span>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="#" class="nav-link" onclick="showSection('home')">Home</a>
                <a href="#" class="nav-link" onclick="showSection('products')">Products</a>
                <a href="#" class="nav-link" id="ordersLink" onclick="showSection('orders')" style="display:none;">Orders</a>
                <a href="#" class="nav-link" id="queriesLink" onclick="showSection('queries')" style="display:none;">Help & Queries</a>
                <a href="#" class="nav-link" id="dashboardLink" onclick="showSection('dashboard')" style="display:none;">Dashboard</a>
                <a href="#" class="nav-link" id="loginLink" onclick="showSection('login')">Login</a>
                <a href="#" class="nav-link" id="registerLink" onclick="showSection('register')">Register</a>
                <a href="#" class="nav-link" id="profileLink" onclick="showSection('profile')" style="display:none;">Profile</a>
                <a href="#" class="nav-link" id="logoutLink" onclick="logout()" style="display:none;">Logout</a>
            </div>
            <div class="nav-cart">
                <i class="fas fa-shopping-cart" onclick="showSection('cart')"></i>
                <span class="cart-count" id="cartCount" style="display: none;">0</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero">
                <h1>Welcome to Live Mart</h1>
                <p>Seamless interaction between customers, retailers, and wholesalers</p>
                <button class="btn-primary" onclick="showSection('products')">Browse Products</button>
            </div>
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-search"></i>
                    <h3>Smart Search</h3>
                    <p>Personalized search and recommendations</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3>Location Based</h3>
                    <p>Find products and shops near you</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-shipping-fast"></i>
                    <h3>Fast Delivery</h3>
                    <p>Real-time order tracking</p>
                </div>
            </div>
        </section>

        <!-- Login Section -->
        <section id="login" class="section">
            <div class="auth-container">
                <h2>Login</h2>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <div class="form-group" id="loginOTPGroup" style="display: none;">
                        <label>Enter OTP sent to your email</label>
                        <input type="text" id="loginOTP" maxlength="6" placeholder="Enter 6-digit OTP" required>
                    </div>
                    <button type="button" class="btn-secondary" id="sendOTPButton" onclick="sendLoginOTP()" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-paper-plane"></i> Send OTP
                    </button>
                    <span id="otpStatus" style="display: block; text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 1rem;"></span>
                    <button type="submit" class="btn-primary" id="loginSubmitButton" disabled style="width: 100%;">Login</button>
                    <p class="auth-link">Don't have an account? <a href="#" onclick="showSection('register')">Register</a></p>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="socialLoginRole">Choose Role for Google/Facebook Login</label>
                        <select id="socialLoginRole">
                            <option value="customer" selected>Customer</option>
                            <option value="retailer">Retailer</option>
                            <option value="wholesaler">Wholesaler</option>
                        </select>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 0.35rem;">
                            This role will be assigned if you sign in via Google or Facebook for the first time.
                        </p>
                    </div>
                    <div style="margin: 1.5rem 0; text-align: center; color: #666;">
                        <p style="margin-bottom: 1rem;">OR</p>
                    </div>
                    <div class="social-login">
                        <button type="button" class="btn-social" onclick="handleSocialLogin('google')">
                            <i class="fab fa-google"></i> Google
                        </button>
                        <button type="button" class="btn-social" onclick="handleSocialLogin('facebook')">
                            <i class="fab fa-facebook"></i> Facebook
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Register Section -->
        <section id="register" class="section">
            <div class="auth-container">
                <h2>Register</h2>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="registerPhone">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="registerRole" required>
                            <option value="customer">Customer</option>
                            <option value="retailer">Retailer</option>
                            <option value="wholesaler">Wholesaler</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="registerAddress"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Location (Click to set on map)</label>
                        <button type="button" class="btn-secondary" onclick="openLocationPicker('register')">
                            <i class="fas fa-map-marker-alt"></i> Set Location on Map
                        </button>
                        <input type="hidden" id="registerLocation">
                        <div id="locationDisplay" style="margin-top:0.5rem; font-size:0.9rem; color:#666;"></div>
                    </div>
                    <button type="submit" class="btn-primary">Register</button>
                    <p class="auth-link">Already have an account? <a href="#" onclick="showSection('login')">Login</a></p>
                </form>
            </div>
        </section>

        <!-- OTP Verification Section -->
        <section id="otp-verify" class="section" style="display:none;">
            <div class="auth-container">
                <h2>Verify OTP</h2>
                <form id="otpForm" onsubmit="handleOTPVerify(event)">
                    <div class="form-group">
                        <label>Enter OTP sent to your email</label>
                        <input type="text" id="otpCode" maxlength="6" required>
                    </div>
                    <button type="submit" class="btn-primary">Verify</button>
                    <button type="button" class="btn-secondary" onclick="resendOTP()">Resend OTP</button>
                </form>
            </div>
        </section>

        <!-- Products Section -->
        <section id="products" class="section">
            <div class="products-header">
                <h2>Products</h2>
                <div class="search-filters">
                    <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchProducts()">
                    <select id="categoryFilter" onchange="searchProducts()">
                        <option value="">All Categories</option>
                    </select>
                    <input type="number" id="minPrice" placeholder="Min Price (₹)" onchange="searchProducts()">
                    <input type="number" id="maxPrice" placeholder="Max Price (₹)" onchange="searchProducts()">
                    <select id="productSort" onchange="handleProductSortChange()">
                        <option value="default">Sort: Featured</option>
                        <option value="distance">Sort: Distance (Nearest)</option>
                    </select>
                    <button class="btn-primary" onclick="getLocationAndSearch()">
                        <i class="fas fa-map-marker-alt"></i> Nearby
                    </button>
                    <button class="btn-primary" onclick="showNearbyShopsMap()">
                        <i class="fas fa-map"></i> Map View
                    </button>
                </div>
            </div>
            <div id="productsGrid" class="products-grid"></div>
        </section>

        <!-- Product Details Section -->
        <section id="product-details" class="section" style="display:none;">
            <div class="product-details-container">
                <button class="btn-back" onclick="showSection('products')">← Back</button>
                <div id="productDetailsContent"></div>
            </div>
        </section>

        <!-- Cart Section -->
        <section id="cart" class="section">
            <h2>Shopping Cart</h2>
            <div id="cartContent"></div>
        </section>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close-modal" onclick="closePaymentModal()">&times;</span>
                <h2>Complete Your Order</h2>
                <div id="paymentModalContent"></div>
            </div>
        </div>

        <!-- Map Section -->
        <section id="map-section" class="section" style="display:none;">
            <h2>Products Map View</h2>
            <p style="color:#666; margin-bottom: 1rem;">Shows the locations of the currently listed products. Grant location access for accurate distance.</p>
            <div id="map" style="width:100%; height:500px; border-radius:10px; margin:1rem 0;"></div>
            <div id="mapProductsList"></div>
        </section>

        <!-- Orders Section -->
        <section id="orders" class="section">
            <h2>My Orders</h2>
            <div id="ordersContent"></div>
        </section>

        <!-- Dashboard Section (Retailer/Wholesaler) -->
        <section id="dashboard" class="section">
            <h2>Dashboard</h2>
            <div class="dashboard-tabs">
                <button class="tab-btn active" onclick="showDashboardTab('inventory')">Inventory</button>
                <button class="tab-btn" onclick="showDashboardTab('orders')">Orders</button>
                <button class="tab-btn" onclick="showDashboardTab('queries')">Queries & Help</button>
                <button class="tab-btn" onclick="showDashboardTab('analytics')">Analytics</button>
            </div>
            <div id="dashboardContent"></div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section">
            <h2>Profile</h2>
            <div id="profileContent"></div>
        </section>

        <!-- Queries/Help Section (Customer) -->
        <section id="queries" class="section">
            <h2>Help & Queries</h2>
            <div style="margin-bottom: 2rem;">
                <button class="btn-primary" onclick="showNewQueryForm()">
                    <i class="fas fa-plus"></i> Raise New Query/Help Request
                </button>
            </div>
            <div id="queriesContent"></div>
        </section>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <!-- Stripe.js is not needed for Checkout, but included for potential future use -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="/app.js"></script>
</body>
</html>

